<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Hana's Music Sandbox VR</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.3.2/dist/aframe-environment-component.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>
</head>
<body>
    <a-scene library-loader>
        
        <a-assets>
            <img id="space-texture" src="https://cdn.aframe.io/a-painter/images/sky.jpg">
        </a-assets>

        <a-entity id="world" environment="preset: forest; dressingAmount: 500; shadow: true;"></a-entity>

        <a-entity id="rig">
            <a-camera position="0 1.6 0"></a-camera>
            
            <a-entity id="leftHand" hand-tracking-controls="hand: left;" laser-controls="hand: left">
                </a-entity>

            <a-entity id="rightHand" hand-tracking-controls="hand: right;" laser-controls="hand: right">
                <a-box id="undo-btn" position="0 0.05 0" width="0.05" height="0.02" depth="0.05" color="red" visible="true"></a-box>
            </a-entity>
        </a-entity>

        <a-entity id="main-handpan" position="0 1.2 -0.8">
            <a-sphere radius="0.4" color="#555" material="metalness: 0.8; roughness: 0.2;">
                <a-cylinder position="0 0.38 0" radius="0.1" height="0.02" color="cyan" class="playable" 
                            animation="property: material.emissiveIntensity; from: 0; to: 1; dir: alternate; loop: true;"></a-cylinder>
            </a-sphere>
        </a-entity>

        <a-entity id="trash-can" position="2 0 -2">
            <a-cylinder radius="0.3" height="0.6" color="#333"></a-cylinder>
            <a-text value="TRASH" position="-0.2 0.8 0" color="white"></a-text>
        </a-entity>

    </a-scene>

    <script>
        // GAME LOGIC: This is the "Brain"
        // 1. Function to create the Loop Circles you wanted
        function createLoopCircle(position, color) {
            const scene = document.querySelector('a-scene');
            const circle = document.createElement('a-entity');
            circle.setAttribute('geometry', 'primitive: ring; radiusInner: 0.2; radiusOuter: 0.25');
            circle.setAttribute('material', `color: ${color}; shader: flat`);
            circle.setAttribute('position', position);
            circle.setAttribute('class', 'grabbable');
            // Adding physics-like behavior for grabbing
            scene.appendChild(circle);
        }

        // 2. Automatic Pointing Gesture
        const rightHand = document.querySelector('#rightHand');
        rightHand.addEventListener('triggerdown', function () {
            // When trigger is pressed, it plays the sound
            console.log("Instrument Played!");
        });

        // 3. Room Switching Logic
        function changeToSpace() {
            const world = document.querySelector('#world');
            world.setAttribute('environment', 'preset: starry; ground: spikes');
        }
    </script>
</body>
</html>
